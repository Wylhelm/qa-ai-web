<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Scenario Generator</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        h1 { color: #333; }
        input, textarea, button { margin: 10px 0; padding: 5px; width: 100%; }
        #history { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Test Scenario Generator</h1>
    <input type="text" id="scenario-name" placeholder="Scenario name">
    <textarea id="criteria" rows="5" placeholder="Enter criteria here..."></textarea>
    <input type="file" id="file-upload" multiple>
    <button id="generate-btn">Generate Test Scenario</button>
    <textarea id="scenario-output" rows="10" readonly></textarea>
    <button id="export-btn">Export Scenario</button>
    <button id="clear-history-btn">Clear History</button>
    <div id="history">
        <h2 id="history-title"></h2>
        <ul id="history-list"></ul>
    </div>

    <script>
        $(document).ready(function() {
            let processedFiles = [];

            $('#file-upload').on('change', function(event) {
                let files = event.target.files;
                for (let file of files) {
                    let formData = new FormData();
                    formData.append('file', file);
                    $.ajax({
                        url: '/upload',
                        type: 'POST',
                        data: formData,
                        processData: false,
                        contentType: false,
                        success: function(response) {
                            processedFiles.push(response);
                            $('#criteria').val($('#criteria').val() + '\n\nExtracted information:\n' + response.extracted_info);
                        }
                    });
                }
            });

            $('#generate-btn').click(function() {
                $.ajax({
                    url: '/generate',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        name: $('#scenario-name').val(),
                        criteria: $('#criteria').val(),
                        processed_files: processedFiles
                    }),
                    success: function(response) {
                        $('#scenario-output').val(response.scenario);
                        loadHistory();
                    }
                });
            });

            $('#export-btn').click(function() {
                let blob = new Blob([$('#scenario-output').val()], {type: 'text/plain'});
                let a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = 'scenario.txt';
                a.click();
            });

            $('#clear-history-btn').click(function() {
                $.post('/clear_history', function() {
                    loadHistory();
                });
            });

            function loadHistory() {
                $.get('/history', function(data) {
                    $('#history-title').text(data.title);
                    let historyList = $('#history-list');
                    historyList.empty();
                    data.scenarios.forEach(function(scenario) {
                        historyList.append(`<li><strong>${scenario.name}</strong> - ${scenario.criteria.split('\n')[0]}</li>`);
                    });
                });
            }

            loadHistory();
        });
    </script>
</body>
</html>
